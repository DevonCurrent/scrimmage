

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCRIMMAGE / ROS Integration &mdash; scrimmage 0.2.0-dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create a ROS Node" href="ros-plugin.html" />
    <link rel="prev" title="Generate Entities at Run-Time" href="gen-entities.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> scrimmage
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml-discovery.html">Plugin / XML File Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-local-runs.html">Multiple Runs on a Local Computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-project.html">Create a SCRIMMAGE Plugins Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="autonomy-plugin.html">Create an Autonomy Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="draw-shapes.html">Draw Shapes in the Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor-plugin.html">Create a Sensor Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller-plugin.html">Create a Controller Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="motion-model-plugin.html">Create a Motion Model Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-interaction-plugin.html">Create an Entity Interaction Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics-plugin.html">Create a Metrics Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Plugin Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pub-sub.html">Publishers and Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen-entities.html">Generate Entities at Run-Time</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SCRIMMAGE / ROS Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-scrimmage-with-python-and-ros">Build SCRIMMAGE with Python and ROS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mission-yaml-file-format">Mission YAML File Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launching-scrimmage-and-ros-in-parallel">Launching SCRIMMAGE and ROS in Parallel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-scrimmage-ros">Build scrimmage_ros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#processes-yaml-file-format">Processes YAML File Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-processes-in-docker">Running processes in docker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ros-plugin.html">Create a ROS Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="airsim-plugin.html">AirSimSensor Plugin Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openai-plugin.html">Create an OpenAI Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="terrain.html">Create a Digital Terrain Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimize.html">Optimizing Parameters in SCRIMMAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-grid.html">Multiple Runs with Open Grid Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Create a SCRIMMAGE Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Useful Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="simcontrol.html">SimControl API</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-the-flag.html">Capture the Flag Scenario</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scrimmage</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>SCRIMMAGE / ROS Integration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/scrimmage-ros-integration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scrimmage-ros-integration">
<h1>SCRIMMAGE / ROS Integration<a class="headerlink" href="#scrimmage-ros-integration" title="Permalink to this headline">¶</a></h1>
<p>For more intricate simulation setups, you may want to be able generate
scrimmage mission files more dynamically. This is especially important when
using scrimmage with ROS. For example, we may want to launch several ROS
autonomies in their own ROS namespaces and start scrimmage with a mission file
that matches the ROS configuration. In this case, scrimmage will generate the
sensor data required by the ROS autonomy, the ROS autonomy will publish a
control signal, scrimmage will subscribe to the control signal, and scrimmage
will apply the control signal to the simulated motion model. The scrimmage
sensor plugins that provide the sensor data publish to ROS topics and the
scrimmage autonomy plugins subscribe to the control signals being published by
the ROS autonomy. In other words, the ROS nodes are performing the real
decision making for the agent and the scrimmage autonomy plugin is just a
translator from ROS messages to internal scrimmage data structures.</p>
<p>In this tutorial, we will be using the scrimmage python project and the
<a class="reference external" href="https://github.com/syllogismrxs/scrimmage_ros">scrimmage_ros</a> repository to
generate a scrimmage mission file at run-time and launch multiple ROS 2D
navigation stacks in their own ROS namespaces.</p>
<div class="section" id="build-scrimmage-with-python-and-ros">
<h2>Build SCRIMMAGE with Python and ROS<a class="headerlink" href="#build-scrimmage-with-python-and-ros" title="Permalink to this headline">¶</a></h2>
<p>To get started, let’s build scrimmage with ROS plugins and python bindings in a
virtual environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup a python virtual environment</span>
$ <span class="nb">cd</span> /path/to/scrimmage
$ mkdir -p build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
$ python3 -m venv env         <span class="c1"># Create the python environment</span>
$ . ./env/bin/activate        <span class="c1"># Activate the environment</span>

<span class="c1"># Install scrimmage python package dependencies</span>
$ pip install -r ../python/requirements.txt

<span class="c1"># Enable scrimmage dependencies</span>
$ . /opt/scrimmage/*/setup.sh

<span class="c1"># Enable the ROS dependencies. Replace ${ROS_VERSION} with &quot;kinetic&quot;,</span>
<span class="c1"># &quot;melodic&quot;, etc.</span>
$ . /opt/ros/<span class="si">${</span><span class="nv">ROS_VERSION</span><span class="si">}</span>/setup.sh

<span class="c1"># Configure scrimmage to build ROS plugins and python 3.5+</span>
$ cmake .. -DBUILD_ROS_PLUGINS<span class="o">=</span>ON -DPYTHON_MIN_VERSION<span class="o">=</span><span class="m">3</span>.5

$ make -j7  <span class="c1"># Build scrimmage</span>

<span class="c1"># Install the scrimmage python package</span>
$ pip install -e ../python
</pre></div>
</div>
<p>After successfully building scrimmage, let’s run a simple test of the scrimmage
Mission Generator python class</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activate the locally built scrimmage environment, which puts the scrimmage</span>
<span class="c1"># executable on the $PATH and updates the $SCRIMMAGE_PLUGIN_PATH.</span>
$ . ~/.scrimmage/setup.sh

<span class="c1"># Run the Mission Generator test, which generates a mission and runs it</span>
<span class="c1"># with scrimmage.</span>
$ python ../python/tests/test_MissionGenerator.py
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MissionGenerator</span></code> class uses template files, the <code class="docutils literal notranslate"><span class="pre">jinja2</span></code> python
package, and a <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file to generate scrimmage mission files. For
example, the <a class="reference external" href="https://github.com/gtri/scrimmage/blob/master/python/tests/test_MissionGenerator.py">test_MissionGenerator.py</a>
test program, uses the template files in <a class="reference external" href="https://github.com/gtri/scrimmage/tree/master/python/tests/templates">scrimmage/python/tests/templates</a> and
<a class="reference external" href="https://github.com/gtri/scrimmage/blob/master/python/tests/templates/mission.yaml">mission.yaml</a>.
The <code class="docutils literal notranslate"><span class="pre">MissionGenerator</span></code> class constructor takes the path to the
<code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file as input:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mg</span> <span class="o">=</span> <span class="n">MG</span><span class="o">.</span><span class="n">MissionGenerator</span><span class="p">(</span><span class="s1">&#39;/path/to/mission.yaml&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can access the contents of the generated scrimmage mission XML through the
<code class="docutils literal notranslate"><span class="pre">MissionGenerator</span></code> class’ <code class="docutils literal notranslate"><span class="pre">mission</span></code> member variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mission_xml</span> <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">mission</span>
</pre></div>
</div>
<p>Typically, the string that contains the contents of the scrimmage mission file
is written to a temporary file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mg</span><span class="o">.</span><span class="n">mission</span><span class="p">)</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p>and then the python <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> package can be used to execute
<code class="docutils literal notranslate"><span class="pre">scrimmage</span></code>, where the path to the temporary file is passed as an argument to
<code class="docutils literal notranslate"><span class="pre">scrimmage</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;scrimmage </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fp</span><span class="o">.</span><span class="n">name</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="mission-yaml-file-format">
<h2>Mission YAML File Format<a class="headerlink" href="#mission-yaml-file-format" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a look at the <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file format to understand how the
<code class="docutils literal notranslate"><span class="pre">MissionGenerator</span></code> class generates a scrimmage mission file from template
files.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span>

<span class="c1"># Relative to current file</span>
<span class="nt">template_directories</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.</span>

<span class="c1"># Configuration for overall mission file</span>
<span class="nt">mission_file</span><span class="p">:</span>
    <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mission.template.xml</span>
    <span class="nt">config</span><span class="p">:</span>
        <span class="nt">time_warp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">latitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">35.721025</span>
        <span class="nt">longitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-120.767925</span>
        <span class="nt">altitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="c1"># Configuration for each entity that will be injected into the mission file</span>
<span class="nt">entities</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">270</span>

    <span class="p p-Indicator">-</span> <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">version</span></code> specifies the YAML format version number for the
<code class="docutils literal notranslate"><span class="pre">MissionGenerator</span></code> class. The <code class="docutils literal notranslate"><span class="pre">template_directories</span></code> variable specifies a
list of absolute or relative (to the <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file) paths to be used
when searching for template files. In this case, the template files are located
in the same directory as the <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file since the <code class="docutils literal notranslate"><span class="pre">.</span></code> path is
included. The <code class="docutils literal notranslate"><span class="pre">mission_file</span></code> specifies the top-level scrimmage mission file
template (<code class="docutils literal notranslate"><span class="pre">mission.template.xml</span></code>) and the <code class="docutils literal notranslate"><span class="pre">config</span></code> values that should be
used during variable substitution by <code class="docutils literal notranslate"><span class="pre">jinja2</span></code>. For example, the
<code class="docutils literal notranslate"><span class="pre">mission.template.xml</span></code> file contains the line:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>time_warp=&quot;{{ config.time_warp }}&quot;
</pre></div>
</div>
<p>and the <code class="docutils literal notranslate"><span class="pre">config</span></code> block contains the value of <code class="docutils literal notranslate"><span class="pre">0</span></code> for the <code class="docutils literal notranslate"><span class="pre">time_warp</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
    <span class="nt">time_warp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<p>After mission file generation, the scrimmage mission file will contain the
text:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>time_warp=&quot;0&quot;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file also contains a list of <code class="docutils literal notranslate"><span class="pre">entities</span></code>, where each
entity is specified by a <code class="docutils literal notranslate"><span class="pre">template</span></code> file and a variable <code class="docutils literal notranslate"><span class="pre">config</span></code> block that
is used during variable substitution.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">entities</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">270</span>

    <span class="p p-Indicator">-</span> <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<p>The top-level scrimmage mission template file (<code class="docutils literal notranslate"><span class="pre">mission.template.xml</span></code>) uses a
<code class="docutils literal notranslate"><span class="pre">jinja2</span></code> for-loop to generate each entity:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">entities</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{{</span> <span class="n">entity</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>An advantage to this template process is that entity templates can be reused
across multiple scrimmage mission files without having to copy and paste XML
blocks.</p>
</div>
<div class="section" id="launching-scrimmage-and-ros-in-parallel">
<h2>Launching SCRIMMAGE and ROS in Parallel<a class="headerlink" href="#launching-scrimmage-and-ros-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>We will now use the <code class="docutils literal notranslate"><span class="pre">scrimmage_ros</span></code> package to launch two ROS agents running
the 2D navigation stack, generate a scrimmage mission file, and pass the
generated mission file to the <code class="docutils literal notranslate"><span class="pre">scrimmage</span></code> executable.</p>
<div class="section" id="build-scrimmage-ros">
<h3>Build scrimmage_ros<a class="headerlink" href="#build-scrimmage-ros" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir -p ~/catkin_ws/src <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/catkin_ws/src
$ git clone git@github.com:SyllogismRXS/scrimmage_ros.git

<span class="c1"># Source the ROS, scrimmage, and scrimmage python environments</span>
$ . /opt/ros/<span class="si">${</span><span class="nv">ROS_VERSION</span><span class="si">}</span>/setup.sh              <span class="c1"># ROS</span>
$ . ~/.scrimmage/setup.bash                       <span class="c1"># scrimmage</span>
$ . ~/scrimmage/scrimmage/build/env/bin/activate  <span class="c1"># scrimmage python</span>

<span class="c1"># Build scrimmage_ros</span>
$ <span class="nb">cd</span> ~/catkin_ws
$ catkin_make
</pre></div>
</div>
<p>Now that the <code class="docutils literal notranslate"><span class="pre">scrimmage_ros</span></code> package has been built, source the catkin_ws
environment and run the python script that will launch the ROS agents and
scrimmage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ . devel/setup.sh
$ python ./src/scrimmage_ros/src/scrimmage_ros/test/test_entity_launch.py
</pre></div>
</div>
<p>Enter CTRL+c to end the simulation. Let’s take a look at the
<code class="docutils literal notranslate"><span class="pre">test_entity_launch.py</span></code> script and the associated template files to see how
the simulation was configured with the <code class="docutils literal notranslate"><span class="pre">EntityLaunch</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entity_launch</span> <span class="o">=</span> <span class="n">EntityLaunch</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">sim_mission_yaml_file</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">.</span><span class="n">processes_yaml_file</span><span class="p">,</span>
                             <span class="n">run_dir</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">EntityLaunch</span></code> takes a <code class="docutils literal notranslate"><span class="pre">mission.yaml</span></code> file and a <code class="docutils literal notranslate"><span class="pre">processes.yaml</span></code>
file as inputs, generates the scrimmage mission file, executes scrimmage with
the generated mission file, and executes the processes in the processes yaml
file.</p>
<p>Finally, the processes are actually executed in parallel with the <code class="docutils literal notranslate"><span class="pre">run()</span></code>
method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the processes. Blocking.</span>
<span class="n">entity_launch</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="processes-yaml-file-format">
<h2>Processes YAML File Format<a class="headerlink" href="#processes-yaml-file-format" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a look at the processes yaml file to understand how it helps us
launch scrimmage in parallel with ROS autonomies:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span>

<span class="c1"># Specify default values</span>
<span class="nt">defaults</span><span class="p">:</span>
    <span class="nt">terminal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gnome</span>
    <span class="nt">environment</span><span class="p">:</span>
        <span class="nt">some_variable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_value</span>

<span class="c1"># Processes that are run before entities are launched</span>
<span class="nt">processes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roscore</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roscore</span>
      <span class="nt">terminal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>
      <span class="nt">post_delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.5</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">map_server</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stdbuf -oL roslaunch scrimmage_ros map_server.launch</span>
      <span class="nt">terminal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>

<span class="c1"># Processes that are run for each entity type</span>
<span class="nt">entity_processes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">car</span>
      <span class="nt">processes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;entity{{</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">}}&#39;</span>
          <span class="nt">command</span><span class="p">:</span> <span class="s">&#39;stdbuf</span><span class="nv"> </span><span class="s">-oL</span><span class="nv"> </span><span class="s">roslaunch</span><span class="nv"> </span><span class="s">scrimmage_ros</span><span class="nv"> </span><span class="s">entity_nav_2d.launch</span><span class="nv"> </span><span class="s">team_id:=1</span><span class="nv"> </span><span class="s">entity_id:={{</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">}}&#39;</span>

      <span class="c1"># Clean up commands run for each entity</span>
      <span class="nt">clean_up</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
          <span class="nt">command</span><span class="p">:</span> <span class="s">&#39;echo</span><span class="nv"> </span><span class="s">&quot;Goodbye,</span><span class="nv"> </span><span class="s">Entity</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># Overall clean up commands</span>
<span class="nt">clean_up</span><span class="p">:</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">processes</span></code> list specifies the processes that will be launch before the
individual entities’ ROS systems are launched. The <code class="docutils literal notranslate"><span class="pre">entity_processes</span></code> list
specifies the processes that will be launched for each entity. In this case, we
will call <code class="docutils literal notranslate"><span class="pre">roslaunch</span></code> for each entity. Each entity has an optional
<code class="docutils literal notranslate"><span class="pre">clean_up</span></code> list of commands and we can specify a global <code class="docutils literal notranslate"><span class="pre">clean_up</span></code> for the
entire system. The processes for each entity are specified with a <code class="docutils literal notranslate"><span class="pre">type</span></code>
tag. In this case, we use the <code class="docutils literal notranslate"><span class="pre">type</span></code> tag, <code class="docutils literal notranslate"><span class="pre">car</span></code>. We will also have to
augment our mission yaml file with the <code class="docutils literal notranslate"><span class="pre">type</span></code> tag, so that the processes that
are launched can be matched with the entities in the scrimmage mission
file. For example, our new mission yaml file will look like the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span>

<span class="c1"># Relative to current file</span>
<span class="nt">template_directories</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.</span>

<span class="c1"># Configuration for overall mission file</span>
<span class="nt">mission_file</span><span class="p">:</span>
    <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mission.template.xml</span>
    <span class="nt">config</span><span class="p">:</span>
        <span class="nt">time_warp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">latitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">35.721025</span>
        <span class="nt">longitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-120.767925</span>
        <span class="nt">altitude_origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="c1"># Configuration for each entity that will be injected into the mission file</span>
<span class="nt">entities</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">car</span>
      <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">270</span>

    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">car</span>
      <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">entity.template.xml</span>
      <span class="nt">config</span><span class="p">:</span>
          <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
          <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
          <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-5</span>
          <span class="nt">heading</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<div class="section" id="running-processes-in-docker">
<h3>Running processes in docker<a class="headerlink" href="#running-processes-in-docker" title="Permalink to this headline">¶</a></h3>
<p>The processes specified in <code class="docutils literal notranslate"><span class="pre">processes.yaml</span></code> can be run in docker as well, keeping in
mind that there is typically no display available (as specified in the <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> environment
variable), which can affect certain terminal programs. The main scrimmage process uses the
default terminal, which may need to be set to <code class="docutils literal notranslate"><span class="pre">none</span></code> for running in docker. And any other
process with its own terminal specified may also need to be set to <code class="docutils literal notranslate"><span class="pre">none</span></code>, or another
terminal program that can run in docker:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span>

<span class="nt">defaults</span><span class="p">:</span>
    <span class="nt">terminal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>
    <span class="nt">environment</span><span class="p">:</span>
        <span class="nt">some_variable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_value</span>

<span class="nt">processes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">process_with_gui</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">process_with_gui</span>
      <span class="nt">terminal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ros-plugin.html" class="btn btn-neutral float-right" title="Create a ROS Node" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gen-entities.html" class="btn btn-neutral float-left" title="Generate Entities at Run-Time" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Kevin DeMarco

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>